# 聊吧论坛后端接口规范

## 一、返回值标准结构

```java
public class Result{
    private Integer code; 
    private Boolean success;
    private String message;
    private Object data;
}
```

## 二、接口规范

接口总览

| 接口前缀         | 对应表                             | 核心场景                   | 权限                                          |
| ---------------- | ---------------------------------- | -------------------------- | --------------------------------------------- |
| `/auth`          | auth_token                         | 登录/登出                  | 登录无Token，登出需登录态                     |
| `/user`          | user                               | 用户注册/信息管理          | 普通操作需登录，管理员带/admin                |
| `/posts`         | post、club                         | 帖子/圈子管理              | 普通操作需登录，权限操作带/admin              |
| `/comments`      | comment                            | 评论管理                   | 普通操作需登录，权限操作带/admin              |
| `/club-applies`  | club_apply_create、club_apply_join | 圈子申请                   | 申请需登录，审核需权限                        |
| `/notifications` | notification                       | 通知管理                   | 仅操作自己的通知                              |
| `/reports`       | report                             | 举报提交/处理/查询         | 提交需登录，处理需管理员/风纪，查询仅本人举报 |
| `/interactions`  | interaction                        | 点赞/踩/关注操作及记录查询 | 仅登录用户操作本人互动，查询本人互动记录      |


### 1. 认证接口（/auth）

| 路径           | 方法 | 入参                                               | 出参                                                         | 权限     | 表操作                       |
| -------------- | ---- | -------------------------------------------------- | ------------------------------------------------------------ | -------- | ---------------------------- |
| `/auth/login`  | POST | email（登录邮箱）、password（密码）                | token（登录令牌）、expireTime（过期时间）、userInfo（id/name/role） | 无需登录 | 插入auth_token（生成令牌）   |
| `/auth/logout` | POST | 无（Token放请求头：Authorization: Bearer {token}） | code:200、message:"登出成功"                                 | 需登录   | 更新auth_token（is_valid=0） |
| `/auth/`       | GET  | 无                                                 | code message userinfo                                        | 需登录   | 无                           |


### 2. 用户接口（/user）

#### 2.1 普通用户操作

| 路径            | 方法 | 入参                                                         | 出参                                           | 权限     | 表操作               |
| --------------- | ---- | ------------------------------------------------------------ | ---------------------------------------------- | -------- | -------------------- |
| `/user`         | POST | email（唯一）、password（密码）、name（用户名）、inviteCode（邀请码） | code:200、message:"注册成功"、userId（用户ID） | 无需登录 | 插入user（新建用户） |
| `/user/profile` | GET  | 无（Token放请求头）                                          | userInfo（id/name/intro/email等）              | 需登录   | 查询user（本人信息） |
| `/user/profile` | PUT  | name（可选）、intro（可选）                                  | code:200、message:"修改成功"                   | 需登录   | 更新user（本人信息） |

#### 2.2 管理员操作

| 路径                        | 方法   | 入参                         | 出参                             | 权限   | 表操作               |
| --------------------------- | ------ | ---------------------------- | -------------------------------- | ------ | -------------------- |
| `/user/admin/{userId}/role` | PUT    | role（USER/MODERATOR/ADMIN） | code:200、message:"角色修改成功" | 管理员 | 更新user（用户角色） |
| `/user/admin/{userId}`      | DELETE | 无                           | code:200、message:"用户删除成功" | 管理员 | 删除user（用户数据） |
| /user/admin/{userId}/reset  | PUT    | password（新密码）           | code:200、message:"密码重置成功" | 管理员 | 更新user（密码哈希） |


### 3. 帖子&圈子接口（/posts）

#### 3.1 帖子操作

| 路径              | 方法   | 入参                                                   | 出参                                | 权限           | 表操作               |
| ----------------- | ------ | ------------------------------------------------------ | ----------------------------------- | -------------- | -------------------- |
| `/posts`          | POST   | title（标题）、content（内容）、clubId（可选，圈子ID） | code:200、postId（帖子ID）          | 需登录         | 插入post（新建帖子） |
| `/posts/{postId}` | GET    | 无                                                     | postInfo（标题/内容/作者/浏览量等） | 无（公开帖）   | 查询post（帖子详情） |
| `/posts`          | GET    | keyword（可选，关键词）、page（页码）、clubId（可选）  | posts（列表）、total（总数）        | 无             | 查询post（帖子列表） |
| `/posts/{postId}` | PUT    | title（可选）、content（可选）                         | code:200、message:"修改成功"        | 需登录（本人） | 更新post（本人帖子） |
| `/posts/{postId}` | DELETE | 无                                                     | code:200、message:"删除成功"        | 需登录（本人） | 更新post（标记删除） |

#### 3.2 帖子权限操作（管理员/风纪）

| 路径                          | 方法 | 入参                       | 出参                         | 权限        | 表操作               |
| ----------------------------- | ---- | -------------------------- | ---------------------------- | ----------- | -------------------- |
| `/posts/admin/{postId}/audit` | PUT  | status（PASS/REJECT）      | code:200、message:"审核完成" | 管理员/风纪 | 更新post（帖子状态） |
| `/posts/{postId}/essence`     | PUT  | isEssence（1=加精/0=取消） | code:200、message:"操作成功" | 管理员/风纪 | 更新post（精华状态） |

#### 3.3 圈子操作

| 路径                    | 方法   | 入参                              | 出参                             | 权限                    | 表操作               |
| ----------------------- | ------ | --------------------------------- | -------------------------------- | ----------------------- | -------------------- |
| `/posts/clubs`          | GET    | page（页码）                      | clubs（列表）、total（总数）     | 无                      | 查询club（圈子列表） |
| `/posts/clubs/{clubId}` | GET    | 无                                | clubInfo（名称/描述/成员数等）   | 无                      | 查询club（圈子详情） |
| `/posts/clubs/{clubId}` | PUT    | name（可选）、description（可选） | code:200、message:"修改成功"     | 需登录（创建者/管理员） | 更新club（圈子信息） |
| `/posts/clubs/{clubId}` | DELETE | 无                                | code:200、message:"圈子解散成功" | 需登录（创建者/管理员） | 删除club（圈子数据） |


### 4. 评论接口（/comments）

| 路径                                | 方法   | 入参                                                         | 出参                            | 权限           | 表操作                      |
| ----------------------------------- | ------ | ------------------------------------------------------------ | ------------------------------- | -------------- | --------------------------- |
| `/comments`                         | POST   | postId（帖子ID）、content（内容）、parentId（可选，父评论ID） | code:200、commentId（评论ID）   | 需登录         | 插入comment（新建评论）     |
| `/comments`                         | GET    | postId（帖子ID）、page（页码）                               | comments（列表）、total（总数） | 无             | 查询comment（评论列表）     |
| `/comments/{commentId}`             | DELETE | 无                                                           | code:200、message:"删除成功"    | 需登录（本人） | 更新comment（is_deleted=1） |
| `/comments/admin/{commentId}/audit` | PUT    | status（PASS/REJECT）                                        | code:200、message:"审核完成"    | 管理员/风纪    | 更新comment（评论状态）     |


### 5. 圈子申请接口（/club-applies）

#### 5.1 创建申请

| 路径                              | 方法 | 入参                                         | 出参                         | 权限        | 表操作                            |
| --------------------------------- | ---- | -------------------------------------------- | ---------------------------- | ----------- | --------------------------------- |
| `/applies/create`                 | POST | name（圈子名称）、description（圈子描述）    | code:200、applyId（申请ID）  | 需登录      | 插入club_apply_create（新建申请） |
| `/applies/create/admin/{applyId}` | PUT  | status（PASS/REJECT）、handledBy（处理人ID） | code:200、message:"审核完成" | 管理员/风纪 | 更新club_apply_create（申请状态） |

#### 5.2 加入申请

| 路径                            | 方法 | 入参                                         | 出参                         | 权限              | 表操作                          |
| ------------------------------- | ---- | -------------------------------------------- | ---------------------------- | ----------------- | ------------------------------- |
| `/applies/join/{clubId}`        | POST | 无                                           | code:200、applyId（申请ID）  | 需登录            | 插入club_apply_join（新建申请） |
| `/applies/join/admin/{applyId}` | PUT  | status（PASS/REJECT）、handledBy（处理人ID） | code:200、message:"审核完成" | 圈子创建者/管理员 | 更新club_apply_join（申请状态） |


### 6. 通知接口（/notifications）

| 路径                             | 方法   | 入参                                        | 出参                                 | 权限           | 表操作                           |
| -------------------------------- | ------ | ------------------------------------------- | ------------------------------------ | -------------- | -------------------------------- |
| `/notifications`                 | GET    | page（页码）、isRead（可选，0=未读/1=已读） | notifications（列表）、total（总数） | 需登录         | 查询notification（通知列表）     |
| `/notifications/{notifyId}/read` | PUT    | 无                                          | code:200、message:"标记已读成功"     | 需登录（本人） | 更新notification（is_read=1）    |
| `/notifications/{notifyId}`      | DELETE | 无                                          | code:200、message:"删除成功"         | 需登录（本人） | 更新notification（is_deleted=1） |


### 7. 举报接口（/reports）

#### 7.1 普通用户操作

| 路径          | 方法 | 入参                                                         | 出参                                                 | 权限   | 表操作                                               |
| ------------- | ---- | ------------------------------------------------------------ | ---------------------------------------------------- | ------ | ---------------------------------------------------- |
| `/reports`    | POST | report_type（举报类型）、report_target_type（被举报对象类型）、report_target（被举报对象ID）、reason（举报理由，可选） | code:200、message:"举报提交成功"、reportId（举报ID） | 需登录 | 插入report（新建举报记录），发送“新举报通知”给管理员 |
| `/reports/my` | GET  | page（页码）、status（可选，举报处理状态）                   | reports（本人举报列表）、total（总数）               | 需登录 | 查询report（本人举报记录）                           |

#### 7.2 管理员/风纪操作

| 路径                        | 方法 | 入参                                                     | 出参                                   | 权限        | 表操作                                                       |
| --------------------------- | ---- | -------------------------------------------------------- | -------------------------------------- | ----------- | ------------------------------------------------------------ |
| `/reports/admin`            | GET  | page（页码）、status（可选）、report_target_type（可选） | reports（全量举报列表）、total（总数） | 管理员/风纪 | 查询report（全量举报记录）                                   |
| `/reports/admin/{reportId}` | PUT  | status（处理状态）、handled_by（处理人ID）               | code:200、message:"举报处理完成"       | 管理员/风纪 | 更新report（处理状态+处理人+处理时间）；若status=PROCESSED，联动处理被举报对象（如帖子/评论置为REJECT），发送“举报处理结果通知”给举报人 |


### 8. 互动接口（/interactions）

#### 8.1 互动操作（点赞/踩/关注）

| 路径                            | 方法   | 入参                                                         | 出参                                                  | 权限           | 表操作                                                       |
| ------------------------------- | ------ | ------------------------------------------------------------ | ----------------------------------------------------- | -------------- | ------------------------------------------------------------ |
| `/interactions`                 | POST   | interact_type（互动类型）、interact_target_type（被互动对象类型）、interact_target（被互动对象ID） | code:200、message:"互动成功"、interactionId（互动ID） | 需登录         | 1. 插入interaction（新建互动记录，若已存在则返回“已互动”）；<br>2. 若为点赞/踩：同步更新post/comment的like_count；<br>3. 若为关注：发送“被关注通知”给被关注用户 |
| `/interactions/{interactionId}` | DELETE | 无                                                           | code:200、message:"取消互动成功"                      | 需登录（本人） | 1. 删除interaction（本人互动记录）；<br>2. 若为点赞/踩：同步减少post/comment的like_count |

#### 8.2 互动记录查询

| 路径                  | 方法 | 入参                                                         | 出参                                                         | 权限   | 表操作                                                       |
| --------------------- | ---- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------ | ------------------------------------------------------------ |
| `/interactions/my`    | GET  | page（页码）、interact_type（可选，互动类型）、interact_target_type（可选，被互动对象类型） | interactions（本人互动列表，含被互动对象基础信息）、total（总数） | 需登录 | 查询interaction（本人互动记录），关联post/comment/user表获取被互动对象详情 |
| `/interactions/count` | GET  | interact_type（互动类型）、interact_target_type（被互动对象类型）、interact_target（被互动对象ID） | data: {count: 互动总数}                                      | 无     | 查询interaction（指定对象的指定互动总数）                    |

### 9.邀请码接口

#### 9.1 用户操作

| 路径           | 方法 | 入参 | 出参             | 权限   | 表操作                                             |
| -------------- | ---- | ---- | ---------------- | ------ | -------------------------------------------------- |
| `/invitecode/` | GET  | 无   | 用户的邀请码列表 | 需登录 | 若已生成邀请码，直接返回邀请码，否则生成一个邀请码 |

#### 9.2 管理员操作

| 路径                 | 方法   | 入参                                | 出参             | 权限   | 表操作                  |
| -------------------- | ------ | ----------------------------------- | ---------------- | ------ | ----------------------- |
| `/invitecode/`       | POST   | maxCount, generateCount, expireTime | 生成的邀请码列表 | 管理员 | 对invite_code表新增项目 |
| `/invitecode/{code}` | DELETE | 无                                  | code:200         | 管理员 | 设置邀请码是否可用      |

