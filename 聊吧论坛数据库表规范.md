## 一、数据库表规范
### 1. 用户表（user）
此表用于储存用户信息

| 字段名             | 类型           | 说明                       | 约束                |
| --------------- | ------------ | ------------------------ | ----------------- |
| id              | bigint       | 用户唯一标识                   | 主键，自增             |
| email           | varchar(64)  | 邮箱（登录账号）                 | 非空，唯一，索引          |
| password        | varchar(128) | 加密存储的密码（如bcrypt哈希）       | 非空                |
| name            | varchar(16)  | 用户名                      | 非空                |
| role            | varchar(16)  | 角色（USER/MODERATOR/ADMIN） | 非空，默认USER，索引      |
| intro           | varchar(64)  | 用户的自我介绍                  | 非空，默认“Hello~”     |
| created_at      | datetime     | 注册时间                     | 非空，默认当前时间，索引      |
| last_login_at   | datetime     | 最近上线时间                   | 可空，默认null（未登录时无值） |
| status          | varchar(16)  | 用户状态(NORMAL/UNABLE)      | 非空，默认NORMAL，索引    |
| avatar_link     | varchar(128) | 头像链接，默认为https://pic1.imgdb.cn/item/6905cbfa3203f7be00bf6e98.webp | 非空，默认"/logo.ico"  |
| background_link | varchar(128) | 背景链接 默认为https://img-s.msn.cn/tenant/amp/entityid/BB1msDBR?w=0&h=0&q=50&m=6&f=jpg&u=t | 可空                |
| used_invite_code | varchar(16)  | 注册使用的邀请码（可空）            | 可空               |

### 2. 令牌表（auth_token）暂时废弃
此表用于储存所有登录令牌

| 字段名         | 类型           | 说明            | 约束               |
| ----------- | ------------ | ------------- | ---------------- |
| id          | bigint       | 令牌唯一标识        | 主键，自增            |
| user_id     | bigint       | 关联用户ID        | 非空，外键（关联user.id，用户删除时级联删除），索引 |
| token       | varchar(256) | 登录态令牌         | 非空，唯一，索引            |
| expire_time | datetime     | 过期时间          | 非空，索引               |
| created_at  | datetime     | 创建时间          | 非空，默认当前时间        |
| is_valid    | tinyint      | 是否合法(1=是，0=否) | 非空，默认1           |

### 3. 帖子表（post）
此表用于储存所有帖子

| 字段名           | 类型          | 说明                             | 约束                            |
| ------------- | ----------- | ------------------------------ | ----------------------------- |
| id            | bigint      | 帖子唯一标识                         | 主键，自增                         |
| title         | varchar(32) | 帖子标题                           | 非空                            |
| content       | text        | 帖子内容                           | 非空                            |
| user_id       | bigint      | 作者用户ID                         | 非空，外键（关联user.id，用户删除时级联删除），索引 |
| club_id       | bigint      | 所属圈子ID（可选）                     | 可空，外键（关联club.id，圈子删除时级联删除），索引 |
| status        | varchar(16) | 状态（PENDING/PASS/REJECT/DELETE） | 非空，默认PENDING，索引               |
| is_essence    | tinyint     | 是否精华（1=是，0=否）                  | 非空，默认0，索引                     |
| created_at    | datetime    | 创建时间                           | 非空，默认当前时间，索引                  |
| updated_at    | datetime    | 更新时间                           | 非空，默认当前时间，自动更新，索引             |
| view_count    | int         | 阅读次数                           | 非空，默认0                        |
| like_count    | int         | 点赞数量                           | 非空，默认0                        |
| comment_count | int         | 评论数量                           | 非空，默认0                        |
| -         | -           | -                  | 复合唯一索引(club_id, status, created_at DESC) |

### 4. 评论表（comment）
此表用于储存所有评论

| 字段名        | 类型           | 说明                             | 约束                            |
| ---------- | ------------ | ------------------------------ | ----------------------------- |
| id         | bigint       | 评论唯一标识                         | 主键，自增                         |
| post_id    | bigint       | 关联帖子ID                         | 非空，外键（关联post.id，帖子删除时级联删除），索引 |
| user_id    | bigint       | 评论者用户ID                        | 非空，外键（关联user.id，用户删除时级联删除），索引 |
| parent_id  | bigint       | 关联回复的评论ID（顶级评论为null）           | 可空，索引                         |
| content    | varchar(128) | 评论内容                           | 非空                            |
| status     | varchar(16)  | 状态（PENDING/PASS/REJECT/DELETE） | 非空，默认PENDING，索引               |
| created_at | datetime     | 创建时间                           | 非空，默认当前时间，索引                  |
| like_count | int          | 点赞数量                           | 非空，默认0                        |
| -         | -           | -                  | 复合唯一索引(post_id, status, created_at) |

### 5. 圈子表（club）
此表用于储存所有的圈子

| 字段名             | 类型           | 说明             | 约束                                |
| --------------- | ------------ | -------------- | --------------------------------- |
| id              | bigint       | 圈子唯一标识         | 主键，自增                             |
| name            | varchar(32)  | 圈子名称           | 非空，唯一，索引                          |
| description     | varchar(128) | 圈子描述           | 可空                                |
| avatar_link     | varchar(128) | 头像链接           | 非空，默认为/icon.ico                   |
| background_link | varchar(128) | 背景链接           | 可空                                |
| creator_id      | bigint       | 创建者用户ID        | 非空，外键（关联user.id，用户删除时圈子软删掉，变为不可加入），索引 |
| created_at      | datetime     | 创建时间           | 非空，默认当前时间，索引                      |
| member_count    | int          | 成员人数           | 非空，默认0，索引                         |
| is_deleted      | tinyint      | 是否被删掉(1=是，0=否) | 非空，默认0，索引                         |

### 6. 圈子成员表（club_member）
此表用于查询圈子所有成员

| 字段名       | 类型          | 说明                 | 约束                       |
| --------- | ----------- | ------------------ | ------------------------ |
| id        | bigint      | 成员关系唯一标识           | 主键，自增                    |
| club_id   | bigint      | 关联圈子ID             | 非空，外键（关联club.id），索引      |
| user_id   | bigint      | 关联用户ID             | 非空，外键（关联user.id），索引      |
| role      | varchar(16) | 成员角色（OWNER/MEMBER） | 非空，默认MEMBER，索引           |
| joined_at | datetime    | 加入时间               | 非空，默认当前时间，索引             |
| -         | -           | -                  | 复合唯一索引（club_id, user_id） |
| -         | -           | -                  | 复合唯一索引（user_id, club_id） |

### 7. 圈子创建申请表（club_apply_create）
此表用于记录所有圈子申请记录

| 字段名         | 类型           | 说明                        | 约束                  |
| ----------- | ------------ | ------------------------- | ------------------- |
| id          | bigint       | 申请唯一标识                    | 主键，自增               |
| user_id     | bigint       | 申请人用户ID                   | 非空，外键（关联user.id），索引 |
| name        | varchar(32)  | 申请创建的圈子名称                 | 非空，索引               |
| description | varchar(128) | 圈子描述                      | 可空                  |
| status      | varchar(16)  | 申请状态（PENDING/PASS/REJECT） | 非空，默认PENDING，索引     |
| handled_by  | bigint       | 处理人用户ID（管理员/风纪）           | 可空，外键（关联user.id），索引 |
| created_at  | datetime     | 申请时间                      | 非空，默认当前时间，索引        |
| updated_at  | datetime     | 处理时间                      | 可空，自动更新，索引          |

### 8. 圈子加入申请表（club_apply_join）
此表用于记录圈子加入记录

| 字段名        | 类型          | 说明                        | 约束                     |
| ---------- | ----------- | ------------------------- | ---------------------- |
| id         | bigint      | 申请唯一标识                    | 主键，自增                  |
| user_id    | bigint      | 申请人用户ID                   | 非空，外键（关联user.id），索引    |
| club_id    | bigint      | 申请加入的圈子ID                 | 非空，外键（关联club.id），索引    |
| status     | varchar(16) | 申请状态（PENDING/PASS/REJECT） | 非空，默认PENDING，索引        |
| handled_by | bigint      | 处理人用户ID（圈子创建者/管理员）        | 可空，外键（关联user.id），索引    |
| created_at | datetime    | 申请时间                      | 非空，默认当前时间，索引           |
| updated_at | datetime    | 处理时间                      | 可空，自动更新，索引             |
| -          | -           | -                         | 复合索引（user_id, club_id） |

### 9. 通知表（notification）
此表用于记录通知信息

| 字段名         | 类型           | 说明                                                                                | 约束                                   |
| ----------- | ----------- | --------------------------------------------------------------------------------- | ------------------------------------ |
| id          | bigint       | 通知唯一标识                                                                            | 主键，自增                                |
| user_id     | bigint       | 接收通知的用户 ID（谁会收到通知）                                                                | 非空，外键（关联 user.id），用户删除时级联删除通知，索引        |
| type        | varchar(32)  | 通知类型（区分场景）：<br>- POST_COMMENT：帖子被评论<br>- COMMENT_REPLY：评论被追评<br>- FOLLOW：被关注 | 非空，索引                                   |
| related_id  | bigint       | 关联的核心资源 ID：<br>- 帖子被评论时=帖子ID<br>- 评论被追评时=原评论ID<br>- 被关注时=被关注者ID | 非空，索引                                   |
| operator_id | bigint       | 操作人 ID（谁触发了通知）                                                            | 非空，外键（关联 user.id），操作人删除时移除通知，索引        |
| content     | varchar(256) | 通知内容                                                                              | 非空                                   |
| is_read     | tinyint      | 是否已读（1=已读，0=未读）                                                               | 非空，默认 0，索引                           |
| is_deleted  | tinyint      | 是否被删掉(1=是，0=否)                                                                    | 非空，默认0，索引                               |
| created_at  | datetime     | 通知创建时间                                                                              | 非空，默认当前时间，索引                            |
| -           | -            | -                                                                                   | 复合索引（user_id, is_read, created_at）        |

### 10. 互动表（interaction）
此表用于记录互动记录，如点赞，踩

| 字段名                  | 类型          | 说明                                   | 约束                                                                    |
| -------------------- | ----------- | ------------------------------------ | --------------------------------------------------------------------- |
| id                   | bigint      | 互动记录唯一标识                             | 主键，自增                                                                 |
| user_id              | bigint      | 发起互动的用户ID（谁进行互动）                     | 非空，外键（关联user.id），用户删除时级联删除，索引                                         |
| interact_type        | varchar(16) | 互动类型（LIKE=点赞/DISLIKE=踩/FOLLOW=关注）    | 非空，索引                                                                 |
| interact_target_type | varchar(16) | 被互动的对象类型（COMMENT=评论/POST=帖子/USER=用户） | 非空，索引                                                                 |
| interact_target      | bigint      | 被互动的对象ID（如帖子ID/评论ID/用户ID）            | 非空，根据interact_target_type关联对应表主键，索引                                   |
| created_at           | datetime    | 互动时间                                 | 非空，默认当前时间，索引                                                          |
| -                    | -           | -                                    | 复合索引（interact_target_type, interact_target, interact_type）            |
| -                    | -           | -                                    | 复合唯一索引（user_id, interact_target_type, interact_target, interact_type） |

### 11. 举报表（report）
此表用于记录举报记录

| 字段名               | 类型         | 说明                                      | 约束                                   |
| -------------------- | ------------ | ----------------------------------------- | -------------------------------------- |
| id                   | bigint       | 举报记录唯一标识                          | 主键，自增                              |
| user_id              | bigint       | 举报人用户ID（谁发起举报）                | 非空，外键（关联user.id），用户删除时级联删除，索引 |
| report_type          | varchar(16)  | 举报类型（SPAM=垃圾信息/ILLEGAL=违法内容/OTHER=其他） | 非空，索引                                   |
| report_target_type   | varchar(16)  | 被举报的对象类型（COMMENT=评论/POST=帖子/USER=用户） | 非空，索引                                   |
| report_target        | bigint       | 被举报的对象ID（如帖子ID/评论ID/用户ID）  | 非空，根据report_target_type关联对应表主键，索引 |
| reason               | varchar(256) | 举报理由（可选）                          | 可空                                   |
| status               | varchar(16)  | 举报处理状态（PENDING=待处理/PROCESSED=已处理） | 非空，默认PENDING，索引                      |
| created_at           | datetime     | 举报时间                                  | 非空，默认当前时间，索引                      |
| handled_at           | datetime     | 处理时间（可选）                          | 可空，索引                               |

### 12.邀请码表(invite_code)
此表用于记录邀请码

| 字段名               | 类型         | 说明                                      | 约束                                   |
| -------------------- | ------------ | ----------------------------------------- | ---------- |
| code                   | varchar(16)  | 邀请码                                      | 主键，唯一，索引                          |
| creator_id                | bigint       | 创建用户的id                         | 非空，外键（关联user.id），索引           |
| created_at           | datetime     | 创建时间                                  | 非空，默认当前时间，索引                      |
| expired_at           | datetime     | 过期时间                                  | 非空，索引                               |
| max_count            | int          | 最大使用次数                          | 非空，默认1                               |
| used_count           | int          | 已使用次数                                  | 非空，默认0                          |

